import { NodemailerAdapterImpl } from "@/adapters/nodemailer-adapter-impl";
import { RabbitAdapterImpl } from "@/adapters/rabbit-adapter-impl";
import { GetEmailsFromQueue } from "@/usecases/get-emails-from-queue";
import { InMemoryMalaDiretaTemplateRepository } from "tests/data/memory-mala-direta-repository copy";
import { InMemoryMalaDiretaRepository } from "../data/memory-mala-direta-repository";

describe("GetEmailsFromQueue Usecase", () => {
  test("espero resgatar todas as mensagens", async () => {
    const queueName = "fila-teste";
    const queue = new RabbitAdapterImpl();
    const listaMaladireta = [];
    const listaTemplate = [];
    const maladiretaRepository = new InMemoryMalaDiretaRepository(listaMaladireta);
    const templateRepository = new InMemoryMalaDiretaTemplateRepository(listaTemplate);
    const mailer = new NodemailerAdapterImpl();
    templateRepository.save({
      code: "abc-123",
      html: `<div> <span style="display: none; opacity: 0; color: transparent; height: 0; width: 0;">Estamos com essa nova vaga, acreditamos que possa ser do seu interesse!</span> <div style="background: #520000; background-color: #520000; margin: 0 auto; max-width: 600px;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="background: #520000; background-color: #520000; width: 100%;" align="center"> <tbody> <tr> <td style="direction: ltr; font-size: 0; padding: 18px 24px; text-align: center; vertical-align: top;"> <div style="font-size: 13px; text-align: left; direction: ltr; display: inline-block; vertical-align: top; width: 100%;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align: top;" width="100%"> <tbody> <tr> <td style="font-size: 0; padding: 0; word-break: break-word;" align="left"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="border-collapse: collapse; border-spacing: 0;"> <tbody> <tr> <td style="width: 111px;"> <a href="https://www.daikokurh.com.br/" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://www.daikokurh.com.br/&amp;source=gmail&amp;ust=1674268115574000&amp;usg=AOvVaw19e_8TY0SOOCCXcxhPtAsy" > <img height="auto" src="https://ci5.googleusercontent.com/proxy/wrPdnJiYE09SmsQabVQxO8yCGI3ho3UZEN9qTP6blmMGhSYBhkNSe9kvvvsryUbZFMbTaeaz5UPlqPbT76i_WOz7X3DKcyMTWHT4DfxAm4XSkUITMf96jA20VVLuc0d_-FOyI_gHDRy6cJ213UMTL6R7XvMS7ih9E6KWCr5c_hC50O2J=s0-d-e1-ft#https://www.daikokurh.com.br/_next/image?url=%2F_next%2Fstatic%2Fmedia%2FLOGO_DAIKOKU_RH.09ed8310.png&amp;w=2048&amp;q=75" width="111" style="border: 0; display: block; outline: 0; text-decoration: none; height: auto; width: 100%;" class="CToWUd" data-bit="iit"/> </a> </td></tr></tbody> </table> </td></tr></tbody> </table> </div></td></tr></tbody> </table> </div><div style="background: #f2f2f2; background-color: #f2f2f2; margin: 0 auto; max-width: 600px;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="background: #f2f2f2; background-color: #f2f2f2; width: 100%;" align="center"> <tbody> <tr> <td style="direction: ltr; font-size: 0; padding: 24px 24px 0; text-align: center; vertical-align: top;"> <div style="margin: 0 auto; max-width: 552px;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="width: 100%;" align="center"> <tbody> <tr> <td style="direction: ltr; font-size: 0; padding: 0 0 16px; text-align: center; vertical-align: top;"> <div style="font-size: 13px; text-align: left; direction: ltr; display: inline-block; vertical-align: top; width: 100%;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%"> <tbody> <tr> <td style="vertical-align: top; padding: 0;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%"> <tbody> <tr> <td style="font-size: 0; padding: 0; word-break: break-word;" align="left"> <div style="font-family: Arial; font-size: 20px; font-weight: 700; line-height: 24px; text-align: left; color: #474744;">Prezado ##NOME##,</div></td></tr></tbody> </table> </td></tr></tbody> </table> </div></td></tr></tbody> </table> </div><div style="margin: 0 auto; max-width: 552px;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="width: 100%;" align="center"> <tbody> <tr> <td style="direction: ltr; font-size: 0; padding: 0; text-align: center; vertical-align: top;"> <div style="font-size: 13px; text-align: left; direction: ltr; display: inline-block; vertical-align: top; width: 100%;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%"> <tbody> <tr> <td style="vertical-align: top; padding: 0;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%"> <tbody> <tr> <td style="font-size: 0; padding: 0 0 16px; word-break: break-word;" align="left"> <div style="font-family: Arial; font-size: 16px; line-height: 24px; text-align: left; color: #474744;"> Gostaríamos de agradecer a todos vocês pelo apoio e confiança que nos foram concedidos ao longo deste ano. Foi um ano atípico e desafiador, mas graças a vocês, conseguimos superar as adversidades e continuar trabalhando com dedicação e comprometimento. </div><div style="font-family: Arial; font-size: 16px; line-height: 24px; text-align: left; color: #474744; margin-top: 20px; margin-bottom: 20px;"> Desejamos a todos um feliz Natal e um próspero Ano Novo. Esperamos que estejam aproveitando as festividades com suas famílias e amigos, e que possam descansar e recarregar as energias para enfrentarmos juntos os desafios que ainda virão. </div><div style="font-family: Arial; font-size: 16px; line-height: 24px; text-align: left; color: #474744; margin-bottom: 20px;"> Mais uma vez, muito obrigado pelo seu apoio e lembrem-se de que estamos à disposição para atender às suas necessidades e dúvidas em todos os momentos. </div><div style="font-family: Arial; font-size: 16px; line-height: 24px; text-align: left; color: #474744;"> Um abraço,<br/> <b>Daikoku RH!</b> </div></td></tr></tbody> </table> </td></tr></tbody> </table> </div></td></tr></tbody> </table> </div><div style="margin: 0 auto; max-width: 552px;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="width: 100%;" align="center"> <tbody> <tr> <td style="direction: ltr; font-size: 0; padding: 0; text-align: center; vertical-align: top;"> <div style="font-size: 13px; text-align: left; direction: ltr; display: inline-block; vertical-align: top; width: 100%;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align: top;" width="100%"> <tbody> <tr> <td style="font-size: 0; word-break: break-word;"><div style="height: 12px;">&nbsp;</div></td></tr></tbody> </table> </div></td></tr></tbody> </table> </div></td></tr></tbody> </table> </div><div style="margin: 0 auto; max-width: 600px;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="width: 100%;" align="center"> <tbody> <tr> <td style="direction: ltr; font-size: 0; padding: 0; text-align: center; vertical-align: top;"> <div style="background: #e7e7e4; background-color: #e7e7e4; margin: 0 auto; max-width: 600px;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="background: #e7e7e4; background-color: #e7e7e4; width: 100%;" align="center"> <tbody> <tr> <td style="direction: ltr; font-size: 0; padding: 24px 24px 0; text-align: left; vertical-align: top;"> <div style="font-size: 13px; text-align: left; direction: ltr; display: inline-block; vertical-align: top; width: 100%;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%"> <tbody> <tr> <td style="vertical-align: top; padding-bottom: 12px;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%"> <tbody> <tr> <td style="font-size: 0; padding: 0 10px 0 0; word-break: break-word;" align="left"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="border-collapse: collapse; border-spacing: 0;"> <tbody> <tr> <td style="width: 111px;"> <img height="auto" src="https://ci5.googleusercontent.com/proxy/wrPdnJiYE09SmsQabVQxO8yCGI3ho3UZEN9qTP6blmMGhSYBhkNSe9kvvvsryUbZFMbTaeaz5UPlqPbT76i_WOz7X3DKcyMTWHT4DfxAm4XSkUITMf96jA20VVLuc0d_-FOyI_gHDRy6cJ213UMTL6R7XvMS7ih9E6KWCr5c_hC50O2J=s0-d-e1-ft#https://www.daikokurh.com.br/_next/image?url=%2F_next%2Fstatic%2Fmedia%2FLOGO_DAIKOKU_RH.09ed8310.png&amp;w=2048&amp;q=75" width="111" style="border: 0; display: block; outline: 0; text-decoration: none; height: auto; width: 100%;" alt="idealista.it" class="CToWUd" data-bit="iit"/> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </div><div style="font-size: 13px; text-align: left; direction: ltr; display: inline-block; vertical-align: bottom; width: 100%;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%"> <tbody> <tr> <td style="vertical-align: bottom; padding-bottom: 12px;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%"> <tbody> <tr> <td style="font-size: 0; padding: 0; word-break: break-word;" align="left"> <div style="font-family: Arial; font-size: 14px; line-height: 1; text-align: left; color: #717164;">© 2018 - 2022</div></td></tr></tbody> </table> </td></tr></tbody> </table> </div></td></tr></tbody> </table> </div><div style="background: #e7e7e4; background-color: #e7e7e4; margin: 0 auto; max-width: 600px;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="background: #e7e7e4; background-color: #e7e7e4; width: 100%;" align="center"> <tbody> <tr> <td style="direction: ltr; font-size: 0; padding: 0 24px 24px; text-align: center; vertical-align: top;"> <div style="font-size: 13px; text-align: left; direction: ltr; display: inline-block; vertical-align: top; width: 100%;"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align: top;" width="100%"> <tbody> <tr> <td style="font-size: 0; padding: 0; word-break: break-word;" align="left"> <div style="font-family: Arial; font-size: 14px; line-height: 1; text-align: left; color: #b4b4ab;"> Caso não haja interesse da sua parte em receber esses emails entre em contato através de <a href="mailto:contato@daikokurh.com.br" target="_blank">contato@daikokurh.com.br</a> e identifique seu email! </div></td></tr></tbody> </table> </div></td></tr></tbody> </table> </div></td></tr></tbody> </table> </div><img height="1" src="https://ci5.googleusercontent.com/proxy/8BJtjujQM04hQT180sdHVnZ1CHlf5E2KPsj76ztCQJt_nEDxXx4qgPvb4qWeV-yPg7A-aLRbffhnsF8J6r8rb0e_cRp1TvDwbX1jLzVf-CaNEDCe-JAshVXBrc1faDtgoXeXwBkW6UBo7LTIwimntaUd01CT9JOq=s0-d-e1-ft#https://www.daikokurh.com.br/_next/image?url=%2F_next%2Fstatic%2Fmedia%2FLOGO_DAIKOKU_RH.09ed8310.png" width="1" border="0" class="CToWUd" data-bit="iit" jslog="138226; u014N:xr6bB; 53:W2ZhbHNlLDJd"/></div>`,
      text: `Gostaríamos de agradecer a todos vocês pelo apoio e confiança que nos foram concedidos ao longo deste ano. Foi um ano atípico e desafiador, mas graças a vocês, conseguimos superar as adversidades e continuar trabalhando com dedicação e comprometimento.Desejamos a todos um feliz Natal e um próspero Ano Novo. Esperamos que estejam aproveitando as festividades com suas famílias e amigos, e que possam descansar e recarregar as energias para enfrentarmos juntos os desafios que ainda virão.Mais uma vez, muito obrigado pelo seu apoio e lembrem-se de que estamos à disposição para atender às suas necessidades e dúvidas em todos os momentos.Um abraço,Daikoku RH!`
    })
    const usecase = new GetEmailsFromQueue(queueName, queue, maladiretaRepository, templateRepository, mailer);
    await usecase.execute();
  })
})